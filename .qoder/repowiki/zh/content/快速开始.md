# 快速开始

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [docs/quickstart.md](file://docs/quickstart.md)
- [samples/agent/adk/restaurant_finder/README.md](file://samples/agent/adk/restaurant_finder/README.md)
- [samples/agent/adk/restaurant_finder/agent.py](file://samples/agent/adk/restaurant_finder/agent.py)
- [samples/agent/adk/restaurant_finder/agent_executor.py](file://samples/agent/adk/restaurant_finder/agent_executor.py)
- [renderers/lit/package.json](file://renderers/lit/package.json)
- [renderers/angular/package.json](file://renderers/angular/package.json)
- [samples/client/lit/shell/app.ts](file://samples/client/lit/shell/app.ts)
- [samples/client/lit/shell/client.ts](file://samples/client/lit/shell/client.ts)
- [samples/client/angular/projects/restaurant/src/app/app.ts](file://samples/client/angular/projects/restaurant/src/app/app.ts)
- [samples/client/angular/projects/restaurant/src/app/client.ts](file://samples/client/angular/projects/restaurant/src/app/client.ts)
- [renderers/angular/src/lib/rendering/renderer.ts](file://renderers/angular/src/lib/rendering/renderer.ts)
- [renderers/angular/src/lib/catalog/default.ts](file://renderers/angular/src/lib/catalog/default.ts)
</cite>

## 目录
1. [简介](#简介)
2. [开发环境设置](#开发环境设置)
3. [运行餐厅查找示例](#运行餐厅查找示例)
4. [集成方式代码示例](#集成方式代码示例)
5. [常见问题排查](#常见问题排查)
6. [总结](#总结)

## 简介

A2UI（Agent-to-User Interface）是一个开源项目，旨在让AI代理能够生成丰富的用户界面。该项目采用声明式JSON格式来描述UI意图，确保代理生成的界面既安全又富有表现力。通过A2UI，开发者可以创建动态、交互式的用户界面，而无需在客户端执行任意代码。

A2UI的核心理念包括安全性优先、LLM友好性、框架无关性和灵活性。它通过将UI结构与实现分离，使得同一份A2UI JSON负载可以在不同框架的客户端上渲染，从而实现跨平台的UI生成。

**Section sources**
- [README.md](file://README.md#L1-L169)

## 开发环境设置

在开始使用A2UI之前，您需要设置开发环境。以下是必要的依赖项和安装步骤。

### 安装Node.js

Node.js是运行Web客户端所必需的。请确保安装v18或更高版本：

```bash
# 检查Node.js版本
node --version

# 如果未安装，请从官网下载并安装
https://nodejs.org/
```

### 安装Python

Python用于运行代理示例。需要Python 3.9或更高版本：

```bash
# 检查Python版本
python3 --version

# 安装UV包管理器
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 获取Gemini API密钥

A2UI示例使用Gemini API生成A2UI响应。您需要一个有效的Gemini API密钥：

1. 访问[Google AI Studio](https://aistudio.google.com/apikey)
2. 创建一个新项目并获取API密钥
3. 将API密钥导出为环境变量：

```bash
export GEMINI_API_KEY="your_gemini_api_key_here"
```

**Section sources**
- [README.md](file://README.md#L107-L109)
- [docs/quickstart.md](file://docs/quickstart.md#L18-L20)

## 运行餐厅查找示例

本节将指导您如何运行一个完整的餐厅查找示例，从启动代理到在客户端查看生成的UI。

### 克隆仓库

首先，克隆A2UI仓库：

```bash
git clone https://github.com/google/a2ui.git
cd a2ui
```

### 设置API密钥

确保已设置Gemini API密钥：

```bash
export GEMINI_API_KEY="your_gemini_api_key_here"
```

### 运行代理（后端）

启动餐厅查找代理：

```bash
cd samples/agent/adk/restaurant_finder
uv run .
```

该代理使用Gemini生成A2UI JSON消息，描述餐厅查找和预订的UI。

### 运行客户端（前端）

在新的终端窗口中，启动Lit客户端：

```bash
# 构建Lit渲染器
cd ../../renderers/lit
npm install
npm run build

# 运行Shell客户端
cd ../../samples/client/lit/shell
npm install
npm run dev
```

浏览器将自动打开`http://localhost:5173`，您可以在其中与代理交互。

### 交互示例

尝试以下提示：

- "为2人预订餐桌" - 观察代理生成预订表单
- "查找附近的意大利餐厅" - 查看动态搜索结果
- "你们的营业时间是什么？" - 体验不同意图的UI布局

**Section sources**
- [docs/quickstart.md](file://docs/quickstart.md#L111-L146)
- [samples/agent/adk/restaurant_finder/README.md](file://samples/agent/adk/restaurant_finder/README.md#L11-L29)

## 集成方式代码示例

本节提供两种集成方式的最小化代码示例：使用Angular渲染器和使用Lit渲染器。

### Angular渲染器集成

Angular渲染器通过依赖注入和指令系统实现A2UI消息的处理和渲染。

#### 核心组件初始化

```typescript
import { MessageProcessor, Surface } from '@a2ui/angular';
import { Types } from '@a2ui/lit/0.8';
import { Component, inject } from '@angular/core';
import { Client } from './client';

@Component({
  selector: 'app-root',
  templateUrl: './app.html',
  styleUrl: 'app.css',
  imports: [Surface],
})
export class App {
  protected client = inject(Client);
  protected processor = inject(MessageProcessor);

  protected async handleSubmit(event: SubmitEvent) {
    event.preventDefault();
    
    if (!(event.target instanceof HTMLFormElement)) {
      return;
    }

    const data = new FormData(event.target);
    const body = data.get('body') ?? null;

    if (body) {
      const message = body as Types.A2UIClientEventMessage;
      await this.client.makeRequest(message);
    }
  }
}
```

#### 消息流处理

```typescript
@Injectable({ providedIn: 'root' })
export class Client {
  private processor = inject(MessageProcessor);

  constructor() {
    this.processor.events.subscribe(async (event) => {
      try {
        const messages = await this.makeRequest(event.message);
        event.completion.next(messages);
        event.completion.complete();
      } catch (err) {
        event.completion.error(err);
      }
    });
  }

  async makeRequest(request: Types.A2UIClientEventMessage | string) {
    let messages: Types.ServerToClientMessage[];

    try {
      this.isLoading.set(true);
      const response = await this.send(request as Types.A2UIClientEventMessage);
      messages = response;
    } catch (err) {
      console.error(err);
      throw err;
    } finally {
      this.isLoading.set(false);
    }

    this.processor.clearSurfaces();
    this.processor.processMessages(messages);
    return messages;
  }
}
```

**Section sources**
- [samples/client/angular/projects/restaurant/src/app/app.ts](file://samples/client/angular/projects/restaurant/src/app/app.ts#L1-L90)
- [samples/client/angular/projects/restaurant/src/app/client.ts](file://samples/client/angular/projects/restaurant/src/app/client.ts#L1-L85)

### Lit渲染器集成

Lit渲染器利用Lit的响应式特性和信号系统来处理A2UI消息流。

#### 核心组件初始化

```typescript
import { SignalWatcher } from "@lit-labs/signals";
import { provide } from "@lit/context";
import { LitElement, html, css } from "lit";
import { customElement, state } from "lit/decorators.js";
import { A2UIClient } from "./client.js";
import { v0_8 } from "@a2ui/lit";
import * as UI from "@a2ui/lit/ui";

@customElement("a2ui-shell")
export class A2UILayoutEditor extends SignalWatcher(LitElement) {
  @provide({ context: UI.Context.themeContext })
  accessor theme: v0_8.Types.Theme = uiTheme;

  @state()
  accessor #requesting = false;

  @state()
  accessor #lastMessages: v0_8.Types.ServerToClientMessage[] = [];

  #processor = v0_8.Data.createSignalA2uiMessageProcessor();
  #a2uiClient = new A2UIClient();
}
```

#### 消息流处理

```typescript
async #sendAndProcessMessage(request) {
  const messages = await this.#sendMessage(request);

  this.#lastMessages = messages;
  this.#processor.clearSurfaces();
  this.#processor.processMessages(messages);
}

#maybeRenderData() {
  if (this.#requesting) {
    return html`<div class="pending">
      <div class="spinner"></div>
      <div class="loading-text">${text}</div>
    </div>`;
  }

  const surfaces = this.#processor.getSurfaces();
  if (surfaces.size === 0) {
    return nothing;
  }

  return html`<section id="surfaces">
    ${repeat(
      this.#processor.getSurfaces(),
      ([surfaceId]) => surfaceId,
      ([surfaceId, surface]) => {
        return html`<a2ui-surface
          .surfaceId=${surfaceId}
          .surface=${surface}
          .processor=${this.#processor}
        ></a2-uisurface>`;
      }
    )}
  </section>`;
}
```

**Section sources**
- [samples/client/lit/shell/app.ts](file://samples/client/lit/shell/app.ts#L1-L561)
- [samples/client/lit/shell/client.ts](file://samples/client/lit/shell/client.ts#L1-L113)

## 常见问题排查

本节提供常见问题的排查列表和解决方案。

### 消息未显示

**问题描述**：发送消息后，客户端没有显示任何响应。

**可能原因和解决方案**：
1. **API密钥问题**：验证API密钥是否正确设置
   ```bash
   echo $GEMINI_API_KEY
   ```
2. **代理未启动**：确保代理服务器正在运行
   ```bash
   cd samples/agent/adk/restaurant_finder
   uv run .
   ```
3. **网络连接问题**：检查客户端与代理的连接

### 组件渲染失败

**问题描述**：UI组件无法正确渲染或显示错误。

**可能原因和解决方案**：
1. **依赖未安装**：确保所有依赖已正确安装
   ```bash
   npm install
   ```
2. **版本不兼容**：检查Angular或Lit版本是否兼容
3. **主题配置错误**：验证主题配置是否正确

### 端口已被占用

**问题描述**：开发服务器无法启动，因为端口5173已被占用。

**解决方案**：
- 开发服务器会自动尝试下一个可用端口
- 检查终端输出以获取实际URL
- 手动指定不同端口：
  ```bash
  npm run dev -- --port 3000
  ```

### Python依赖问题

**问题描述**：运行代理时出现Python错误。

**解决方案**：
```bash
# 确保Python 3.10+已安装
python3 --version

# 手动安装依赖
cd ../../agent/adk/restaurant_finder
pip install -r requirements.txt
```

**Section sources**
- [docs/quickstart.md](file://docs/quickstart.md#L224-L250)

## 总结

通过本指南，您已经学习了如何设置A2UI开发环境、运行完整的餐厅查找示例，并了解了两种集成方式的代码实现。A2UI通过声明式JSON格式实现了安全、灵活的代理生成UI，为开发者提供了强大的工具来创建交互式应用。

关键要点：
- A2UI采用声明式数据格式，确保安全性
- 支持多种前端框架集成
- 提供清晰的消息流处理机制
- 具有完善的错误处理和调试支持

现在，您可以基于这些基础构建自己的A2UI应用，探索更多高级功能和自定义组件。

**Section sources**
- [README.md](file://README.md#L1-L169)
- [docs/quickstart.md](file://docs/quickstart.md#L1-L271)