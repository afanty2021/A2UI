# 组件

<cite>
**本文档中引用的文件**  
- [components.md](file://docs/concepts/components.md)
- [components.md](file://docs/reference/components.md)
- [default.ts](file://renderers/angular/src/lib/catalog/default.ts)
- [component-registry.ts](file://renderers/lit/src/0.8/ui/component-registry.ts)
- [button.ts](file://renderers/angular/src/lib/catalog/button.ts)
- [button.ts](file://renderers/lit/src/0.8/ui/button.ts)
- [text-field.ts](file://renderers/lit/src/0.8/ui/text-field.ts)
- [checkbox.ts](file://renderers/lit/src/0.8/ui/checkbox.ts)
- [slider.ts](file://renderers/lit/src/0.8/ui/slider.ts)
- [datetime-input.ts](file://renderers/lit/src/0.8/ui/datetime-input.ts)
- [column.ts](file://renderers/lit/src/0.8/ui/column.ts)
- [row.ts](file://renderers/lit/src/0.8/ui/row.ts)
- [surface.ts](file://renderers/lit/src/0.8/ui/surface.ts)
- [card.ts](file://renderers/lit/src/0.8/ui/card.ts)
- [modal.ts](file://renderers/lit/src/0.8/ui/modal.ts)
- [text.ts](file://renderers/lit/src/0.8/ui/text.ts)
- [image.ts](file://renderers/lit/src/0.8/ui/image.ts)
- [video.ts](file://renderers/lit/src/0.8/ui/video.ts)
- [audio.ts](file://renderers/lit/src/0.8/ui/audio.ts)
- [divider.ts](file://renderers/lit/src/0.8/ui/divider.ts)
- [list.ts](file://renderers/lit/src/0.8/ui/list.ts)
- [tabs.ts](file://renderers/lit/src/0.8/ui/tabs.ts)
- [multiple-choice.ts](file://renderers/lit/src/0.8/ui/multiple-choice.ts)
- [standard_catalog_definition.json](file://specification/0.9/json/standard_catalog_definition.json)
</cite>

## 目录
1. [介绍](#介绍)
2. [组件体系概述](#组件体系概述)
3. [组件分类与功能](#组件分类与功能)
4. [核心属性与事件机制](#核心属性与事件机制)
5. [渲染器实现一致性](#渲染器实现一致性)
6. [组件注册与自定义扩展](#组件注册与自定义扩展)
7. [实际应用示例](#实际应用示例)

## 介绍

A2UI 是一个声明式的用户界面框架，其核心构建单元是组件（Component）。组件作为UI的基本元素，通过扁平化的邻接表模型进行组织，使得LLM能够轻松生成、客户端能够高效渲染，并支持增量更新和动态交互。本文档全面阐述A2UI的组件体系，包括组件的角色、声明方式、分类、核心属性、事件处理以及在不同渲染器中的实现一致性。

**本节不分析具体源文件，因此无来源信息**

## 组件体系概述

A2UI采用**邻接表模型**来组织组件层次结构，而非传统的嵌套JSON树。这种设计带来了诸多优势：LLM可以轻松生成扁平结构，组件可以增量发送，任何组件都可以通过ID进行更新，结构与数据得以清晰分离。

每个组件都包含三个基本要素：
1. **ID**：组件实例的唯一标识符
2. **类型（type）**：组件的种类（如Text、Button、Card等）
3. **属性（props）**：特定于该类型的配置

组件通过ID引用其子组件，而不是通过嵌套。这种扁平结构使得添加、更新和删除组件都变得简单直接。

**Section sources**
- [components.md](file://docs/concepts/components.md#L3-L37)

## 组件分类与功能

A2UI的组件体系分为四大类：基础输入类、容器布局类、内容展示类和复合交互类，共22个标准组件。

### 基础输入类

基础输入类组件提供用户与界面交互的基本方式。

#### Button（按钮）

按钮组件用于触发操作。它通过`action`属性定义点击时要执行的动作，并通过`child`属性引用要显示的内容组件（通常是Text或Icon）。

```json
{
  "id": "submit-btn",
  "component": {
    "Button": {
      "child": "submit-text",
      "primary": true,
      "action": {"name": "submit_form"}
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L117-L146)
- [button.ts](file://renderers/angular/src/lib/catalog/button.ts#L17-L57)
- [button.ts](file://renderers/lit/src/0.8/ui/button.ts)

#### Checkbox（复选框）

复选框组件用于布尔值的切换。它通过`value`属性绑定到数据路径，实现双向数据绑定。

```json
{
  "id": "terms-checkbox",
  "component": {
    "Checkbox": {
      "label": {"literalString": "我同意条款"},
      "value": {"path": "/form/agreedToTerms"}
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L166-L178)
- [checkbox.ts](file://renderers/lit/src/0.8/ui/checkbox.ts#L17-L140)

#### Text-field（文本输入框）

文本输入框组件用于文本输入。它支持多种输入类型（短文本、长文本、数字、日期、密码等），并通过`text`属性实现数据绑定。

```json
{
  "id": "email-input",
  "component": {
    "TextField": {
      "label": {"literalString": "邮箱地址"},
      "text": {"path": "/user/email"},
      "textFieldType": "shortText"
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L147-L165)
- [text-field.ts](file://renderers/lit/src/0.8/ui/text-field.ts#L17-L132)

#### Slider（滑块）

滑块组件用于在一定范围内选择数值。它通过`value`、`minValue`和`maxValue`属性定义取值范围和当前值。

```json
{
  "id": "volume-slider",
  "component": {
    "Slider": {
      "value": {"path": "/settings/volume"},
      "minValue": {"literalNumber": 0},
      "maxValue": {"literalNumber": 100},
      "label": {"literalString": "音量"}
    }
  }
}
```

**Section sources**
- [slider.ts](file://renderers/lit/src/0.8/ui/slider.ts#L17-L160)

#### Datetime-input（日期时间输入）

日期时间输入组件用于选择日期和/或时间。通过`enableDate`和`enableTime`属性控制显示模式。

```json
{
  "id": "meeting-time",
  "component": {
    "DateTimeInput": {
      "value": {"path": "/meeting/time"},
      "enableDate": true,
      "enableTime": true
    }
  }
}
```

**Section sources**
- [datetime-input.ts](file://renderers/lit/src/0.8/ui/datetime-input.ts#L17-L198)

### 容器布局类

容器布局类组件用于组织和排列其他组件。

#### Row（行）

行组件创建水平布局容器，子组件从左到右排列。

```json
{
  "id": "toolbar",
  "component": {
    "Row": {
      "children": {"explicitList": ["back-btn", "title", "menu-btn"]},
      "alignment": "center"
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L7-L28)
- [row.ts](file://renderers/lit/src/0.8/ui/row.ts)

#### Column（列）

列组件创建垂直布局容器，子组件从上到下排列。

```json
{
  "id": "content",
  "component": {
    "Column": {
      "children": {"explicitList": ["header", "body", "footer"]}
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L29-L49)
- [column.ts](file://renderers/lit/src/0.8/ui/column.ts#L17-L105)

#### Surface（表面）

表面组件是UI的根容器，用于承载整个界面或模态窗口。

**Section sources**
- [surface.ts](file://renderers/lit/src/0.8/ui/surface.ts)

#### Card（卡片）

卡片组件创建带有边框、阴影和内边距的容器，常用于信息分组。

```json
{
  "id": "info-card",
  "component": {
    "Card": {
      "child": "card-content"
    }
  }
}
```

**Section sources**
- [card.ts](file://renderers/lit/src/0.8/ui/card.ts)

#### Modal（模态框）

模态框组件创建覆盖在当前界面之上的对话框，通常用于重要提示或操作确认。

```json
{
  "id": "confirmation-modal",
  "component": {
    "Modal": {
      "entryPointChild": "open-modal-btn",
      "contentChild": "modal-content"
    }
  }
}
```

**Section sources**
- [modal.ts](file://renderers/lit/src/0.8/ui/modal.ts)

### 内容展示类

内容展示类组件用于呈现各种类型的信息。

#### Text（文本）

文本组件用于显示文本内容，支持通过`usageHint`属性指定样式（如h1、h2、body等）。

```json
{
  "id": "title",
  "component": {
    "Text": {
      "text": {"literalString": "欢迎使用A2UI"},
      "usageHint": "h1"
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L52-L69)
- [text.ts](file://renderers/lit/src/0.8/ui/text.ts)

#### Image（图像）

图像组件用于从URL加载和显示图片。

```json
{
  "id": "logo",
  "component": {
    "Image": {
      "url": {"literalString": "https://example.com/logo.png"}
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L70-L83)
- [image.ts](file://renderers/lit/src/0.8/ui/image.ts)

#### Video（视频）

视频组件用于嵌入和播放视频内容。

**Section sources**
- [video.ts](file://renderers/lit/src/0.8/ui/video.ts)

#### Audio（音频）

音频组件用于嵌入和播放音频内容。

**Section sources**
- [audio.ts](file://renderers/lit/src/0.8/ui/audio.ts)

#### Divider（分隔线）

分隔线组件用于在界面中创建视觉分隔。

```json
{
  "id": "separator",
  "component": {
    "Divider": {
      "axis": "horizontal"
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L100-L113)
- [divider.ts](file://renderers/lit/src/0.8/ui/divider.ts)

#### List（列表）

列表组件用于创建可滚动的项目列表，支持通过`template`属性动态生成列表项。

```json
{
  "id": "message-list",
  "component": {
    "List": {
      "children": {
        "template": {
          "dataBinding": "/messages",
          "componentId": "message-item"
        }
      }
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L232-L247)
- [list.ts](file://renderers/lit/src/0.8/ui/list.ts)

#### Tabs（标签页）

标签页组件创建选项卡式界面，允许在不同内容视图之间切换。

```json
{
  "id": "settings-tabs",
  "component": {
    "Tabs": {
      "tabItems": [
        {"title": {"literalString": "常规"}, "child": "general-settings"},
        {"title": {"literalString": "隐私"}, "child": "privacy-settings"},
        {"title": {"literalString": "高级"}, "child": "advanced-settings"}
      ]
    }
  }
}
```

**Section sources**
- [components.md](file://docs/reference/components.md#L213-L229)
- [tabs.ts](file://renderers/lit/src/0.8/ui/tabs.ts)

### 复合交互类

#### Multiple-choice（多选）

多选组件提供一组选项供用户选择，支持单选或多选。

```json
{
  "id": "color-picker",
  "component": {
    "MultipleChoice": {
      "options": [
        {"label": {"literalString": "红色"}, "value": "red"},
        {"label": {"literalString": "绿色"}, "value": "green"},
        {"label": {"literalString": "蓝色"}, "value": "blue"}
      ],
      "value": {"path": "/user/preferredColor"}
    }
  }
}
```

**Section sources**
- [multiple-choice.ts](file://renderers/lit/src/0.8/ui/multiple-choice.ts)

## 核心属性与事件机制

所有A2UI组件都遵循统一的属性和事件处理机制。

### 核心属性

每个组件实例都包含以下核心属性：
- **id**（必需）：组件的唯一标识符
- **type**：组件的类型，决定其外观和行为
- **props**：组件的配置属性，根据组件类型而异

此外，大多数组件支持通用属性：
- `weight`：当组件是Row或Column的直接子组件时的flex-grow值
- `theme`：主题信息，用于样式定制

**Section sources**
- [components.md](file://docs/concepts/components.md#L40-L48)
- [standard_catalog_definition.json](file://specification/0.9/json/standard_catalog_definition.json#L48-L196)

### 事件处理机制

A2UI的事件处理基于组件的`action`属性。当用户与组件交互（如点击按钮）时，组件会触发相应的动作，该动作被发送到LLM进行处理。

例如，按钮组件的`handleClick`方法会调用`sendAction`来发送定义的动作：

```typescript
protected handleClick() {
  const action = this.action();
  if (action) {
    super.sendAction(action);
  }
}
```

**Section sources**
- [button.ts](file://renderers/angular/src/lib/catalog/button.ts#L49-L55)

## 渲染器实现一致性

A2UI支持多种渲染器（如Lit和Angular），确保组件在不同框架中表现一致。

### Lit渲染器

基于Web Components标准，使用Lit库实现。每个组件都是一个自定义元素（如`a2ui-button`），通过`@customElement`装饰器注册。

### Angular渲染器

基于Angular框架实现，每个组件都是一个Angular组件（如`a2ui-button`），通过`@Component`装饰器定义。

尽管实现技术不同，但两种渲染器都遵循相同的组件模型和API，确保了跨框架的一致性。

**Section sources**
- [button.ts](file://renderers/angular/src/lib/catalog/button.ts#L17-L57)
- [button.ts](file://renderers/lit/src/0.8/ui/button.ts)
- [default.ts](file://renderers/angular/src/lib/catalog/default.ts#L17-L186)

## 组件注册与自定义扩展

A2UI通过`componentRegistry`实现组件的动态注册和自定义扩展。

### ComponentRegistry

`ComponentRegistry`是一个中心化的注册表，负责管理所有可用的组件类型。它提供`register`和`get`方法来注册和获取组件构造函数。

```typescript
export class ComponentRegistry {
  private registry: Map<string, CustomElementConstructorOf<HTMLElement>> = new Map();

  register(typeName: string, constructor: CustomElementConstructorOf<HTMLElement>, tagName?: string) {
    this.registry.set(typeName, constructor);
    const actualTagName = tagName || `a2ui-custom-${typeName.toLowerCase()}`;
    if (!customElements.get(actualTagName)) {
      customElements.define(actualTagName, constructor);
    }
  }

  get(typeName: string): CustomElementConstructorOf<HTMLElement> | undefined {
    return this.registry.get(typeName);
  }
}

export const componentRegistry = new ComponentRegistry();
```

### 自定义组件扩展

开发者可以通过`componentRegistry.register`方法注册自定义组件，从而扩展A2UI的功能。自定义组件可以是特定领域的图表、地图或其他专用小部件。

**Section sources**
- [component-registry.ts](file://renderers/lit/src/0.8/ui/component-registry.ts#L17-L59)

## 实际应用示例

以下是一个完整的按钮组件定义示例，展示了如何在消息中定义组件及其事件绑定：

```json
{
  "surfaceUpdate": {
    "components": [
      {
        "id": "welcome-button",
        "component": {
          "Button": {
            "child": "btn-label",
            "primary": true,
            "action": {"name": "greet_user"}
          }
        }
      },
      {
        "id": "btn-label",
        "component": {
          "Text": {
            "text": {"literalString": "点击我"}
          }
        }
      }
    ]
  }
}
```

在这个示例中，我们定义了一个ID为`welcome-button`的按钮，它包含一个文本子组件`btn-label`，并绑定到名为`greet_user`的动作。当用户点击按钮时，该动作将被发送到LLM进行处理。

**Section sources**
- [components.md](file://docs/concepts/components.md#L20-L33)
- [components.md](file://docs/reference/components.md#L117-L146)